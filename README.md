# Nuts Node Pentest Setup

This setup has been published on https://github.com/nuts-foundation/pentest-setup

The following has been set up:

- Nuts Node with all its HTTP APIs exposed on port `1323`,
- with a DID document configured as node DID (connection authentication)

The node has been configured to use "strict mode" which disallows unsafe default configurations.

## TLS

TLS has been disabled on HTTP endpoints. In a production situation, the following paths (and their subpaths) should be secured by TLS:

- `/public` with a publicly trusted server certificate.
- `/n2n` with a PKIoverheid Private server certificate, also requiring a client certificate (same chain).
- gRPC with a PKIoverheid Private server certificate, also requiring a client certificate (same chain).
- Other endpoints aren't secured with TLS, since they're meant for internal use (administrative apps, monitoring)

## Private keys

Persisted on disk found in `./data/crypto` (host mount) and `/opt/data/crypto` (in container).

## Endpoints of Interest

The following endpoints are considered of interest due to their attack surface.
They are in order of criticalness (topmost is deemed most critical).

### Creating an Access Token
HTTP endpoint used to gain access to medical data at other parties.

```http request
POST /n2n/auth/v1/accesstoken
```

### gRPC Network Protocol
Nuts nodes communicate using a gRPC network protocol, available on port `5555`.

### Public IRMA endpoints
IRMA authentication uses a mobile app which communicates with publicly available endpoints, exposed by the Nuts Node.

Creating an IRMA signing session:

```http request
POST /public/auth/irmaclient/session
```

Querying the status of a session:

```http request
GET /public/auth/irmaclient/session/<token>
```

### Signing a JWT

```http request
POST /internal/crypto/v1/sign_jwt
```

### Nuts Node status
Endpoint for returning node status (OK/not OK).

```http request
GET /status
```

### Diagnosing Nuts Node
Endpoint for returning detailed node status in JSON or YAML format (depends on `Accept` header).

```http request
GET /status/diagnostics
```

### Monitoring Nuts Node
Endpoint for returning Prometheus metrics of the node.

```http request
GET /metrics
```